<html layout:decorate="~{layout}">
    <div layout:fragment="content" class="container my-3">
        <!-- ÏßàÎ¨∏ Ï†úÎ™© Î∞è ÎÇ¥Ïö© -->
        <h2 class="border-bottom py-2" th:text="${question.subject}"></h2>
        <div class="card my-3">
            <div class="card-body">
                <div class="card-text" th:utext="${@commonUtil.markdown(question.content)}"></div>
                <div class="d-flex justify-content-end">
                <div class="badge bg-light text-dark p-2 text-start">
                    <div th:text="${#temporals.format(question.createDate, 'yyyy-MM-dd HH:mm')}"></div>
                </div>
            </div>
        </div>
    </div>

        <!-- Ïù¥ÎØ∏ÏßÄ Ï∂úÎ†• -->
    <div>
        <img th:if="${question.imageUrl}" th:src="@{${question.imageUrl}}" alt="Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ" style="max-width: 100%; height: auto;" />
    </div>

    <!-- ÎãµÎ≥ÄÏùò Í∞ØÏàò ÌëúÏãú -->
    <div class="count-heart d-flex justify-content-start align-items-center">
        <!-- Ï¢ãÏïÑÏöî -->
        <h5 class="my-3 py-2 me-3 d-flex align-items-center">
            <button 
                id="like-button" 
                class="btn d-flex align-items-center no-focus" 
                th:data-question-id="${question.id}">
                <span class="me-2">‚ù§Ô∏è</span>
                <span id="like-count" th:text="|Ï¢ãÏïÑÏöî ${question.likes}|"></span>
            </button>
        </h5>        
    
        <!-- ÎåìÍ∏Ä -->
        <h5 class="my-3 py-2 d-flex align-items-center">
            <span class="me-2">üí¨</span> <!-- ÎåìÍ∏Ä Ïù¥Î™®Ìã∞ÏΩò -->
            <span th:text="|ÎåìÍ∏Ä ${#lists.size(question.answerList)}|"></span>
        </h5>
    </div>

    <!-- ÎãµÎ≥Ä Î∞òÎ≥µ ÏãúÏûë -->
    <div th:each="answer : ${question.answerList}">
        <div class="d-flex align-items-start py-3">
            <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© -->
            <div>
                <p class="mb-1" th:utext="${@commonUtil.markdown(answer.content)}"></p>
            </div>
        </div>
        <hr class="my-3"> <!-- ÎåìÍ∏Ä Íµ¨Î∂ÑÏÑ† -->
    </div>

    <!-- ÎãµÎ≥Ä Î∞òÎ≥µ ÎÅù -->

    <!-- ÎãµÎ≥Ä ÏûëÏÑ± -->
    <!-- <form th:action="@{|/question/answer/create/${question.id}|}" th:object="${answerForm}" method="post" class="my-3">
        <div th:replace="~{form_errors :: formErrorsFragment}"></div>
        <textarea th:field="*{content}" rows="10" class="form-control"></textarea>
        <input type="submit" value="ÎãµÎ≥ÄÎì±Î°ù" class="btn btn-primary my-2">
    </form> -->
    <form th:action="@{|/question/answer/create/${question.id}|}" th:object="${answerForm}" method="post" class="my-5">
        <div th:replace="~{form_errors :: formErrorsFragment}"></div>
        <!-- ÎåìÍ∏Ä ÏûÖÎ†• Î∞ïÏä§ -->
        <div class="card">
            <div class="card-body">
                <textarea 
                    th:field="*{content}" 
                    rows="3" 
                    class="form-control border-0"
                    placeholder="ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî." 
                    style="resize: none; background-color: #ffffff;"></textarea>
                <div class="text-end mt-2">
                    <input 
                        type="submit" 
                        value="ÎåìÍ∏ÄÎã¨Í∏∞" 
                        class="btn btn-outline-secondary px-4 py-1" 
                        style="border-radius: 20px;">
                </div>
            </div>
        </div>
    </form>
    <script>
        const likeButton = document.getElementById("like-button");
        const likeCountSpan = document.getElementById("like-count");

        // Î≤ÑÌäºÏùò data-question-id ÏÜçÏÑ±ÏóêÏÑú ÏßàÎ¨∏ IDÎ•º ÎèôÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
        const questionId = likeButton.getAttribute("data-question-id");

        if (!questionId) {
            console.error("Invalid question ID");
        } else {
            likeButton.addEventListener("click", function () {
                fetch(`/question/like/${questionId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    // Ï¢ãÏïÑÏöî Î¨∏Íµ¨Îäî Ïú†ÏßÄÌïòÍ≥† Ïà´ÏûêÎßå ÏóÖÎç∞Ïù¥Ìä∏
                    const currentText = likeCountSpan.textContent;
                    const updatedCount = `Ï¢ãÏïÑÏöî ${data.likes}`;
                    if (!currentText.startsWith("Ï¢ãÏïÑÏöî")) {
                        likeCountSpan.textContent = updatedCount;
                    } else {
                        likeCountSpan.textContent = updatedCount;
                    }
                })
                .catch(error => console.error("Error:", error));
            });
        }

    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/upload.js}"></script>
</html>
